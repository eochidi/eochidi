
## Business Task

-   To analyze data from the Fitbit data set to gain insight into how customers use it.
-   Apply the insights gotten to better position Bellabeat leaf, a product of Bellabeat with similar usage to Fitbit.
-   Make a presentation to the CEO, Co-founder, and Bellabeat data analytics team.

## Prepare

The data set to be used is the Fitbit data tracker hosted on Kaggle.

### About the data set

This data set was generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016 - and 05.12.2016.
Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring.

The data set consists of 18 separate CSV files in both long and wide formats.
Some of the data have been merged already so I will not be using all the CSV files for my analysis.

There are several issues with the data set.

1.  The period is not long enough to get accurate results.
2.  There are no demographics of the users.
3.  The data is not recent as it has been collected over six years ago.

The data set is licensed under CC0 public domain, making it free for public use without breaking any copyright violation.
The data usability is rated 10.0 by Kaggle which represents the level of documentation of the data set.

The data sets contain data on steps, intensities, calories, sleep, weight, and distance covered by participants.
This will help me gain insights into the Fitbit usage by the participants and present my findings.

I opened the files in excel to see how they were stored and if analysis could be done using spreadsheets.
The content was too large to use spreadsheets so I decided to use RStudio which can handle much larger data and can show visualizations at the same time.

## Process

### 1.  Install packages in RStudio

I installed the following packages as they contain the tools I will need to carry out all the tasks in this project.


```{r results=FALSE}
install.packages("tidyverse")
install.packages("lubridate")
install.packages("janitor")
install.packages("skmr")
install.packages("here")
```

### Load packages

After installing the packages we need to load their vasious librarys so we can use them in our workspace



```{r results=FALSE}
library(tidyverse)
library(lubridate)
library(janitor)
library(skimr)
library(here)
library(dplyr)
```

### Import data sets

After previewing the data, I decided to use the following files as they contain all the necessary information I need to carry out
my analysis. 
I used the codes below to import the files to dataframes that will be used for the analysis.


```{r results='hold'}
daily_activity <- read_csv("../input/fitbit/Fitabase Data 4.12.16-5.12.16/dailyActivity_merged.csv")
daily_sleep <- read_csv("../input/fitbit/Fitabase Data 4.12.16-5.12.16/sleepDay_merged.csv")
hourly_steps <- read_csv("../input/fitbit/Fitabase Data 4.12.16-5.12.16/hourlySteps_merged.csv")
```
### Cleaning the data

**Check the number of unique Id's and duplicates**
The following function will be used to check the number of unique Id's in each of our dataframes.


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
n_distinct(daily_activity$Id)
n_distinct(daily_sleep$Id)
n_distinct(hourly_steps$Id)
```

**Check for duplicates**

The following functions will be used to check for duplicates in our dataframes.

```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
sum(duplicated(daily_activity))
sum(duplicated(daily_sleep))
sum(duplicated(hourly_steps))
```

**Remove duplicates and drop null values**

We see that the daily sleep data frame has 3 duplicate values.
The code chunk below is used to select the unique Id's and drop duplicate Id's.


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
daily_activity <- daily_activity %>%
  distinct() %>%
  drop_na()
daily_sleep <- daily_sleep %>%
  distinct() %>%
  drop_na()
hourly_steps <- hourly_steps %>%
  distinct() %>%
  drop_na()
```

**Confirm duplicates in sleep table have been removed.**

We will use the same function to check if the duplicate

```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
sum(duplicated(daily_sleep))
```

**Rename columns and change date format from characters to date.
daily activity**

The columns are already in camel case, so I decided to continue with that since it is more convenient.
I will be changing only the date columns in our data frames from character to date format. I will also
change their column names to Date to make it easier when I merge tables.
The hourly steps table I will change the format from character to date, and change the column name to date_time.


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
daily_activity <- daily_activity %>%
  rename(Date = ActivityDate) %>%
  mutate(Date = as_date(Date, format = "%m/%d/%Y"))
head(daily_activity)
```

daily sleep

```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
daily_sleep <- daily_sleep %>%
  rename(Date = SleepDay) %>%
  mutate(Date = as_date(Date,format ="%m/%d/%Y %I:%M:%S %p" , tz=Sys.timezone()))
head(daily_sleep)
```

Hourly Steps

```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
hourly_steps<- hourly_steps %>% 
  rename(date_time = ActivityHour) %>% 
  mutate(date_time = as.POSIXct(date_time,format ="%m/%d/%Y %I:%M:%S %p" , tz=Sys.timezone()))
head(hourly_steps)
```

## Analyze

### Aggregate data and search for patterns.

I will check for patterns and correlations in the daily activity, trimming it smaller sizes and summarising the dat


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
daily_activity %>%
  select(Id, Date, TotalSteps,Calories)%>%
  summary()
```

And also check for patterns in active minutes


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
daily_activity %>%
  select(
    VeryActiveMinutes, FairlyActiveMinutes, 
    LightlyActiveMinutes,SedentaryMinutes
  ) %>%
  summary()
```


We notice by checking the mean minutes that our users spend more time in sedentary and light activities.

Plot a scatter plot to view the correlation between total steps and calories


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
ggplot(data=daily_activity, aes(x=TotalSteps, y=Calories)) + 
  geom_point() + geom_smooth() + labs(title="Total Steps vs. Calories")
```


Calculate the correlation coefficient.


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
total_steps <- daily_activity$TotalSteps
calories <- daily_activity$Calories
cor(total_steps, calories)
```

We notice a moderately positive correlation, this may be as a result of the limited time the survey was carried out.
Since its a positive correlation none the less, we can assume that more steps leads to more calories used.

> Key takeaway: There is a positive correlation between total steps taken and calories burnt.
Next we will classify our users into user groups according to the time they spend in active minutes.
We will use the total steps taken to classify our users into these groups.
We get our guide on activity levels from [www.10000steps.org](https://www.10000steps.org.au/articles/counting-steps/)

Group users by steps taken


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
daily_average_steps <- daily_activity %>%
  group_by(Id) %>%
  summarise (mean_steps = mean(TotalSteps))
head(daily_average_steps)
```


Group users according to average steps taken per day


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
user_group <- daily_average_steps %>%
  mutate(user_group = case_when(
    mean_steps < 5000 ~ "sedentary",
    mean_steps >= 5000 & mean_steps <= 7499 ~ "lightly active", 
    mean_steps >= 7500 & mean_steps <= 9999 ~ "moderately active", 
    mean_steps >= 10000 ~ "very active"
  ))
head(user_group)
```


Group user group sizes by percentage.


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
user_group_size <- user_group %>%
  group_by(user_group) %>%
  summarise(total = n()) %>%
  mutate(totals = sum(total)) %>%
  group_by(user_group) %>%
  summarise(total_percent = total / totals) %>%
  mutate(size = scales::percent(total_percent))
user_group_size$user_group <- factor(user_group_size$user_group , levels = c("very active", "moderately active", "lightly active", "sedentary"))
head(user_group_size)
```


Now we plot a column chart to better visualize our user groups


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
ggplot(user_group_size)+
  geom_col(mapping = aes(user_group, size,fill=user_group))+
  labs(title="User group distribution", x=NULL) +
  theme(legend.position="none", text = element_text(size = 14),plot.title = element_text(hjust = 0.5))
```


> key takeaway: Our users spend the most time in moderately and lightly active minutes

### Analyze the daily sleep data


Next we analyze the daily sleep table We check for correlation between time in bed and time asleep


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
ggplot(data=daily_sleep, aes(x=TotalMinutesAsleep, y=TotalTimeInBed)) + 
  geom_point() + geom_smooth() + labs(title="Time in bed Vs Minutes Asleep", x="Minutes Asleep", y = "Time in bed")
```


Next we calculate the correlation coefficient.


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
minutes_asleep <- daily_sleep$TotalMinutesAsleep
time_in_bed <- daily_sleep$TotalTimeInBed
cor(minutes_asleep, time_in_bed)
```


We notice a very strong positive correlation between time in bed and time asleep.

>Key takeaway: A strong correlation between time in bed and minutes asleep
We will now merge the daily activities data frame with the daily sleep data frame to find patterns and correlation between daily activities and sleep.


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
daily_activity_sleep <- merge(daily_activity, daily_sleep, by=c ("Id", "Date"))
str(daily_activity_sleep)
n_distinct(daily_activity_sleep$Id)
```


We used an inner join so our total users in this data frame is 24,

We will now check for correlation between total steps and time asleep.


```{r echo=TRUE}
ggplot(data=daily_activity_sleep, aes(x=TotalSteps, y=TotalMinutesAsleep)) + 
  geom_point() + geom_smooth() + labs(title="Total Steps Vs Minutes Asleep", x="Total Steps", y = "Time Asleep")
```


Calculate correlation coefficient


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
total_daily_steps <- daily_activity_sleep$TotalSteps
time_asleep <- daily_activity_sleep$TotalMinutesAsleep
cor(total_daily_steps, time_asleep)
```


We did not notice any correlation between total steps and total minutes asleep.

> Key takeaway: No correlation between total steps and sleep
Next we check for correlation between sedentary minutes and total minutes asleep.


```{r echo=TRUE}
ggplot(data=daily_activity_sleep, aes(x=SedentaryMinutes, y=TotalMinutesAsleep)) + 
  geom_point() + geom_smooth() + labs(title="Sedentary Minutes Vs Minutes Asleep", x="Sedentary Minutes", y = "Time Asleep")
```

We now calculate the correlation coefficient:


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
sedentary_mins <- daily_activity_sleep$SedentaryMinutes
time_asleep <- daily_activity_sleep$TotalMinutesAsleep
cor(sedentary_mins, time_asleep)
```


We notice a moderately negative correlation.
We could consider this a negative correlation given that the period the data was collected is short.
Therefore we can say the more time spent in sedentary minutes negatively affects sleep.

> Takeaway: The more time spent in sedentary minutes negativly affects sleep.

### Analyze steps and sleep patterns on a daily basis

Now we look at how many steps our users take each day of the week and observe their sleep patterns on a daily basis.


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
weekday_steps <- daily_activity %>%
  mutate(weekday = weekdays(Date))
weekday_steps$weekday <-ordered(weekday_steps$weekday, levels=c("Monday", "Tuesday", "Wednesday", "Thursday",                                "Friday", "Saturday", "Sunday"))
```


Group and summarize average daily steps by days of the week.


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
weekday_steps <-weekday_steps%>%
  group_by(weekday) %>%
  summarize (daily_steps = mean(TotalSteps))
head(weekday_steps)
```


Visualize average steps taken on a daily basis


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
ggplot(weekday_steps) +
  geom_col(aes(weekday, daily_steps), fill = "#007799") +
  labs(title = "Average steps taken on a daily basis", x= "", y = "") +
  theme(axis.text.x = element_text(angle = 45,vjust = 0.5, hjust = 1))
```


> Takeaway: We notice that most of our users do not meet the daily step requirement of 8000 steps.

We also analyze sleep patterns on a daily basis.


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
weekday_sleep <- daily_sleep %>%
  mutate(weekday = weekdays(Date))
weekday_sleep$weekday <-ordered(weekday_sleep$weekday, levels=c("Monday", "Tuesday", "Wednesday", "Thursday",   "Friday", "Saturday", "Sunday"))
```


Group average minutes asleep on a daily basie


```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
weekday_sleep <-weekday_sleep%>%
  group_by(weekday) %>%
  summarize (daily_sleep = mean(TotalMinutesAsleep))
view(weekday_sleep)
```

Visualise sleep patterns on a weekly basis.

```{r echo=TRUE}
ggplot(weekday_sleep) +
  geom_col(aes(weekday, daily_sleep), fill = "#007755") +
  geom_hline(yintercept = 480) +
  labs(title = "Daily sleep patterns", x= "", y = "") +
  theme(axis.text.x = element_text(angle = 45,vjust = 0.5, hjust = 1))
```


> Takeaway: Most of our users barely get the recommended daily sleep of 8 hours.

### Analyse Hourly Steps

Next we analyse the hourly steps to understand average steps taken on an hourly basis.

```{r echo=TRUE, collapse=TRUE, comment="#>", paged.print=TRUE}
hourly_steps <- hourly_steps %>%
  separate(date_time, into = c("date", "time"), sep= " ") %>%
  mutate(date = ymd(date))
head(hourly_steps)
```

Summarize and group average steps on an hourly basis and then visualize the results.


```{r echo=TRUE}
hourly_steps %>%
  group_by(time) %>%
  summarize(average_steps = mean(StepTotal)) %>%
  ggplot() +
  geom_col(mapping = aes(x=time, y = average_steps, fill = average_steps)) + 
  labs(title = "Steps taken each hour of the day", x="", y="") + 
  scale_fill_gradient(low = "blue", high = "orange")+
  theme(axis.text.x = element_text(angle = 90))
```


From our graph we can see that our users are more active during 11am - 2pm and 5pm - 7pm

> Key takeaway: Our users are mostly corporate workere that get to move around more during lunch time and closing hours.
## Summary

-   There is a positive correlation between total steps and calories.
-   Most of our users spend more time in fairly and lightly active minutes.
-   There is a strong correlation between time in bed and minutes asleep.
-   We did not notice any correlation between total steps taken and total minutes asleep.
-   The amount of time spent in sedentary minutes negatively affects sleep.
-   Most of our users do not meet the daily steps requirement of 8,000 steps.
-   Most of our users barely get the daily recommended 8 hours of sleep.
-   Our users are mostly active between the hours of 11am -2pm and 5pm - 7pm. This pattern fits users who work in a corporate environment and get to move more during lunch break and closing time.
-   63% of our users used Fitbit to track sleep while just 24% used it to track weight.

## Conclusion

The Bellabeat leaf urban is designed to help women keep track of their health data and also use as a fashion accessory For us to come to any business decisions I will advice to collect more data that covers a longer period and shows some level of demographics.
That being said from the analysis we carried out we can make the following suggestions:

-   Notifications when sedentary minutes reach a certain threshold
-   Notifications on when a user has not met the daily required steps and its getting late.
-   Notifications when the user did not get enough sleep.
-   When advertising we should use the demographics of workers in corporate settings
-   Emphasis should be made on sleekness of design to show its easy to sleep with it on.
-   Content related to women health and how it can be monitored with Bellabeat should be sent to users regularly.

Thank you for your audience.
